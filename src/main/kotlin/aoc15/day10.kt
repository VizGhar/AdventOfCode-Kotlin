package aoc15

import measuredNano
import java.io.File

object Day10 {

    data class Description(
        val value: String,
        val spread: List<String>
    ) { val length = value.length.toLong() }

    // generated from https://en.wikipedia.org/wiki/Look-and-say_sequence
    val names = mapOf(
        "22" to "H",
        "13112221133211322112211213322112" to "He",
        "312211322212221121123222112" to "Li",
        "111312211312113221133211322112211213322112" to "Be",
        "1321132122211322212221121123222112" to "B",
        "3113112211322112211213322112" to "C",
        "111312212221121123222112" to "N",
        "132112211213322112" to "O",
        "31121123222112" to "F",
        "111213322112" to "Ne",
        "123222112" to "Na",
        "3113322112" to "Mg",
        "1113222112" to "Al",
        "1322112" to "Si",
        "311311222112" to "P",
        "1113122112" to "S",
        "132112" to "Cl",
        "3112" to "Ar",
        "1112" to "K",
        "12" to "Ca",
        "3113112221133112" to "Sc",
        "11131221131112" to "Ti",
        "13211312" to "V",
        "31132" to "Cr",
        "111311222112" to "Mn",
        "13122112" to "Fe",
        "32112" to "Co",
        "11133112" to "Ni",
        "131112" to "Cu",
        "312" to "Zn",
        "13221133122211332" to "Ga",
        "31131122211311122113222" to "Ge",
        "11131221131211322113322112" to "As",
        "13211321222113222112" to "Se",
        "3113112211322112" to "Br",
        "11131221222112" to "Kr",
        "1321122112" to "Rb",
        "3112112" to "Sr",
        "1112133" to "Y",
        "12322211331222113112211" to "Zr",
        "1113122113322113111221131221" to "Nb",
        "13211322211312113211" to "Mo",
        "311322113212221" to "Tc",
        "132211331222113112211" to "Ru",
        "311311222113111221131221" to "Rh",
        "111312211312113211" to "Pd",
        "132113212221" to "Ag",
        "3113112211" to "Cd",
        "11131221" to "In",
        "13211" to "Sn",
        "3112221" to "Sb",
        "1322113312211" to "Te",
        "311311222113111221" to "I",
        "11131221131211" to "Xe",
        "13211321" to "Cs",
        "311311" to "Ba",
        "11131" to "La",
        "1321133112" to "Ce",
        "31131112" to "Pr",
        "111312" to "Nd",
        "132" to "Pm",
        "311332" to "Sm",
        "1113222" to "Eu",
        "13221133112" to "Gd",
        "3113112221131112" to "Tb",
        "111312211312" to "Dy",
        "1321132" to "Ho",
        "311311222" to "Er",
        "11131221133112" to "Tm",
        "1321131112" to "Yb",
        "311312" to "Lu",
        "11132" to "Hf",
        "13112221133211322112211213322113" to "Ta",
        "312211322212221121123222113" to "W",
        "111312211312113221133211322112211213322113" to "Re",
        "1321132122211322212221121123222113" to "Os",
        "3113112211322112211213322113" to "Ir",
        "111312212221121123222113" to "Pt",
        "132112211213322113" to "Au",
        "31121123222113" to "Hg",
        "111213322113" to "Tl",
        "123222113" to "Pb",
        "3113322113" to "Bi",
        "1113222113" to "Po",
        "1322113" to "At",
        "311311222113" to "Rn",
        "1113122113" to "Fr",
        "132113" to "Ra",
        "3113" to "Ac",
        "1113" to "Th",
        "13" to "Pa",
        "3" to "U"
    )

    val mappings = mapOf(
        "H" to Description("22", listOf("H")),
        "He" to Description("13112221133211322112211213322112", listOf("Hf", "Pa", "H", "Ca", "Li")),
        "Li" to Description("312211322212221121123222112", listOf("He")),
        "Be" to Description("111312211312113221133211322112211213322112", listOf("Ge", "Ca", "Li")),
        "B" to Description("1321132122211322212221121123222112", listOf("Be")),
        "C" to Description("3113112211322112211213322112", listOf("B")),
        "N" to Description("111312212221121123222112", listOf("C")),
        "O" to Description("132112211213322112", listOf("N")),
        "F" to Description("31121123222112", listOf("O")),
        "Ne" to Description("111213322112", listOf("F")),
        "Na" to Description("123222112", listOf("Ne")),
        "Mg" to Description("3113322112", listOf("Pm", "Na")),
        "Al" to Description("1113222112", listOf("Mg")),
        "Si" to Description("1322112", listOf("Al")),
        "P" to Description("311311222112", listOf("Ho", "Si")),
        "S" to Description("1113122112", listOf("P")),
        "Cl" to Description("132112", listOf("S")),
        "Ar" to Description("3112", listOf("Cl")),
        "K" to Description("1112", listOf("Ar")),
        "Ca" to Description("12", listOf("K")),
        "Sc" to Description("3113112221133112", listOf("Ho", "Pa", "H", "Ca", "Co")),
        "Ti" to Description("11131221131112", listOf("Sc")),
        "V" to Description("13211312", listOf("Ti")),
        "Cr" to Description("31132", listOf("V")),
        "Mn" to Description("111311222112", listOf("Cr", "Si")),
        "Fe" to Description("13122112", listOf("Mn")),
        "Co" to Description("32112", listOf("Fe")),
        "Ni" to Description("11133112", listOf("Zn", "Co")),
        "Cu" to Description("131112", listOf("Ni")),
        "Zn" to Description("312", listOf("Cu")),
        "Ga" to Description("13221133122211332", listOf("Eu", "Ca", "Ac", "H", "Ca", "Zn")),
        "Ge" to Description("31131122211311122113222", listOf("Ho", "Ga")),
        "As" to Description("11131221131211322113322112", listOf("Ge", "Na")),
        "Se" to Description("13211321222113222112", listOf("As")),
        "Br" to Description("3113112211322112", listOf("Se")),
        "Kr" to Description("11131221222112", listOf("Br")),
        "Rb" to Description("1321122112", listOf("Kr")),
        "Sr" to Description("3112112", listOf("Rb")),
        "Y" to Description("1112133", listOf("Sr", "U")),
        "Zr" to Description("12322211331222113112211", listOf("Y", "H", "Ca", "Tc")),
        "Nb" to Description("1113122113322113111221131221", listOf("Er", "Zr")),
        "Mo" to Description("13211322211312113211", listOf("Nb")),
        "Tc" to Description("311322113212221", listOf("Mo")),
        "Ru" to Description("132211331222113112211", listOf("Eu", "Ca", "Tc")),
        "Rh" to Description("311311222113111221131221", listOf("Ho", "Ru")),
        "Pd" to Description("111312211312113211", listOf("Rh")),
        "Ag" to Description("132113212221", listOf("Pd")),
        "Cd" to Description("3113112211", listOf("Ag")),
        "In" to Description("11131221", listOf("Cd")),
        "Sn" to Description("13211", listOf("In")),
        "Sb" to Description("3112221", listOf("Pm", "Sn")),
        "Te" to Description("1322113312211", listOf("Eu", "Ca", "Sb")),
        "I" to Description("311311222113111221", listOf("Ho", "Te")),
        "Xe" to Description("11131221131211", listOf("I")),
        "Cs" to Description("13211321", listOf("Xe")),
        "Ba" to Description("311311", listOf("Cs")),
        "La" to Description("11131", listOf("Ba")),
        "Ce" to Description("1321133112", listOf("La", "H", "Ca", "Co")),
        "Pr" to Description("31131112", listOf("Ce")),
        "Nd" to Description("111312", listOf("Pr")),
        "Pm" to Description("132", listOf("Nd")),
        "Sm" to Description("311332", listOf("Pm", "Ca", "Zn")),
        "Eu" to Description("1113222", listOf("Sm")),
        "Gd" to Description("13221133112", listOf("Eu", "Ca", "Co")),
        "Tb" to Description("3113112221131112", listOf("Ho", "Gd")),
        "Dy" to Description("111312211312", listOf("Tb")),
        "Ho" to Description("1321132", listOf("Dy")),
        "Er" to Description("311311222", listOf("Ho", "Pm")),
        "Tm" to Description("11131221133112", listOf("Er", "Ca", "Co")),
        "Yb" to Description("1321131112", listOf("Tm")),
        "Lu" to Description("311312", listOf("Yb")),
        "Hf" to Description("11132", listOf("Lu")),
        "Ta" to Description("13112221133211322112211213322113", listOf("Hf", "Pa", "H", "Ca", "W")),
        "W" to Description("312211322212221121123222113", listOf("Ta")),
        "Re" to Description("111312211312113221133211322112211213322113", listOf("Ge", "Ca", "W")),
        "Os" to Description("1321132122211322212221121123222113", listOf("Re")),
        "Ir" to Description("3113112211322112211213322113", listOf("Os")),
        "Pt" to Description("111312212221121123222113", listOf("Ir")),
        "Au" to Description("132112211213322113", listOf("Pt")),
        "Hg" to Description("31121123222113", listOf("Au")),
        "Tl" to Description("111213322113", listOf("Hg")),
        "Pb" to Description("123222113", listOf("Tl")),
        "Bi" to Description("3113322113", listOf("Pm", "Pb")),
        "Po" to Description("1113222113", listOf("Bi")),
        "At" to Description("1322113", listOf("Po")),
        "Rn" to Description("311311222113", listOf("Ho", "At")),
        "Fr" to Description("1113122113", listOf("Rn")),
        "Ra" to Description("132113", listOf("Fr")),
        "Ac" to Description("3113", listOf("Ra")),
        "Th" to Description("1113", listOf("Ac")),
        "Pa" to Description("13", listOf("Th")),
        "U" to Description("3", listOf("Pa")),
    )

    val input = File("inputs/aoc15/d10.txt").readText()

    val memo = mutableMapOf<Pair<String, Int>, Long>()

    fun String.solve(depth: Int): Long = memo.getOrPut(this to depth) {
        val target = mappings[this]?: throw IllegalArgumentException("$this is not atomic element")
        if (depth == 0) target.length
        else target.spread.sumOf { element -> element.solve(depth - 1) }
    }

    fun part1() = names[input]?.solve(40) ?: throw IllegalArgumentException("Unsupported input")

    fun part2() = names[input]?.solve(50) ?: throw IllegalArgumentException("Unsupported input")

}

fun main() {
    measuredNano { Day10.part1() }
    measuredNano { Day10.part2() }
}
